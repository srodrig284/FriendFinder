<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>FriendFinder</title>

    <script src="https://code.jquery.com/jquery.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
    <link href="css/ghpages-materialize.css" type="text/css" rel="stylesheet" media="screen,projection">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>

<body>
    <div class="container">
        <div class="row">
            <form class="col s12">
                <div class="light-blue lighten-2">
                    <h2 class="z-depth-5" text-align="center">Survey Questions</h2>
                </div>


                <h3><strong>About You</strong></h3>
                <div class="row">
                    <form class="col s12">
                        <div class="row">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">account_circle</i>
                                <input  id="name" type="text" class="validate" required="required" aria-required="true">
                                <label for="name" data-error="wrong" data-success="right">Name (Required)</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">add_a_photo</i>
                                <input  id="photo" type=url class="validate" required="required" aria-required="true">
                                <label for="photo" data-error="wrong" data-success="right">Link to Photo Image (Required)</label>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="divider"></div>


                <span class="blue-text text-darken-2"><h4><strong>Question 1</strong></h4></span>
                <h5>Your mind is always buzzing with unexplored ideas and plans.</h5>
                <div class="input-field col s12">
                    <select id="q1" required="required" aria-required="true ">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 2</strong></h4></span>
                <h5>Generally speaking, you rely more on your experience than your imagination.</h5>
                <div class="input-field col s12">
                    <select id="q2" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 3</strong></h4></span>
                <h5>You find it easy to stay relaxed and focused even when there is some pressure.</h5>
                <div class="input-field col s12">
                    <select id="q3" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 4</strong></h4></span>
                <h5>You rarely do something just out of sheer curiosity.</h5>
                <div class="input-field col s12">
                    <select id="q4" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 5</strong></h4></span>
                <h5>People can rarely upset you.</h5>
                <div class="input-field col s12">
                    <select id="q5" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 6</strong></h4></span>
                <h5>It is often difficult for you to relate to other people’s feelings.</h5>
                <div class="input-field col s12">
                    <select id="q6" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 7</strong></h4></span>
                <h5>In a discussion, truth should be more important than people’s sensitivities.</h5>
                <div class="input-field col s12">
                    <select id="q7" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 8</strong></h4></span>
                <h5>You rarely get carried away by fantasies and ideas.</h5>
                <div class="input-field col s12">
                    <select id="q8" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 9</strong></h4></span>
                <h5>You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h5>
                <div class="input-field col s12">
                    <select id="q9" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="divider"></div>

                <span class="blue-text text-darken-2"><h4><strong>Question 10</strong></h4></span>
                <h5>You feel more energetic after spending time with a group of people.</h5>
                <div class="input-field col s12">
                    <select id="q10" required="required" aria-required="true">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <br>
                <br>

                <!-- Submit Button -->
                <button type="submit" class="btn waves-effect waves-light" id="submit-answers" name="action" style="width:100%">Submit
                    <i class="material-icons right">send</i>
                </button>
            </form>
        </div>

        <br>
        <hr>
        <br>
        <footer class="footer">
            <div class="container">
                <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/srodrig284/FriendFinder.git">GitHub Repo</a></p>
            </div>
        </footer>

    </div> <!--END container class -->

    <!-- Modal -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <h4>Your Best Match</h4>
            <div class="modal-body">

            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Close</a>
        </div>
    </div>



    <div id="window-resizer-tooltip" style="display: none;"><a href="#" title="Edit settings"></a><span class="tooltipTitle">Window size: </span><span class="tooltipWidth" id="winWidth">1279</span> x <span class="tooltipHeight" id="winHeight">725</span><br><span class="tooltipTitle">Viewport size: </span><span class="tooltipWidth" id="vpWidth">1279</span> x <span class="tooltipHeight" id="vpHeight">221</span></div>

</body>
</html>



<!-- BELOW CODE IS CRITICAL. IT HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
<script type="text/javascript">
    // Initialize Materialize select statement and modal functionality
    $('select').material_select();
    $('.modal').modal();




    // Capture the form inputs
    $("#submit-answers").on("click", function(){
        // Prevent form from submitting
        event.preventDefault();

        // Form validation
        function validateForm() {
            var isValid = true;
            $('.validate').each(function() {
                if ( $(this).val() === '' )
                    isValid = false;
                console.log("validating validate");
            });
            console.log("after validate isValid = ", isValid);

          /*  $('.validateopt').each(function() {
                if ( $(this).val() === '' )
                    isValid = false;
                console.log("validating validateopt");
            });
            */
            $("select[required]").each(function() {
                if ( $(this).val() === '' )
                    isValid = false;
                console.log("validating validateopt");
            });
            console.log("after validateopt isValid = ", isValid);
            return isValid;
        }


        // If all required fields are filled
        if (validateForm() == true) {
            // Create an object for the user's data
            var userData = {
                name: $("#name").val(),
                photo: $("#photo").val(),
                scores: [$("#q1").val(), $("#q2").val(), $("#q3").val(), $("#q4").val(), $("#q5").val(), $("#q6").val(), $("#q7").val(), $("#q8").val(), $("#q9").val(), $("#q10").val()]
            };


            // Grab the URL of the website
            var currentURL = window.location.origin;

            // AJAX post the data to the friends API.
            $.post(currentURL + "/api/friends", userData, function (data) {

                // Grab the result from the AJAX post so that the best match's name and photo are displayed.
                $("#matchName").text(data.name);
                $('#matchImg').attr("src", data.photo);

                // Show the modal with the best match
                displayModal(data);

            });
        }
        else
        {
            alert("Please fill out all fields before submitting!");
        }

    });

    /**
     *
     * @param friendtMatch
     */
    function displayModal(friendtMatch) {
        console.log('modal function triggered');

        $(".modal-body").empty();
        $(".modal-body").append('<p>Your match is ' + friendtMatch.name + '!</p>');
        $(".modal-body").append('<img src="' + friendtMatch.photo + '">');

        $('#resultsModal').modal('open');
    }

</script>
